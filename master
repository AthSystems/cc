local modem = peripheral.find("modem") or error("No modem", 0)
rednet.open(peripheral.getName(modem))

local nodeDrills = 0
local drill_state = false
local kw_drills_frontward = "frontward"
local kw_drills_fb_frontward = "DFF"
local kw_drills_backward = "backward"
local kw_drills_fb_backward = "DFB"

function send(id, message)
    print("→ Sending to " .. id .. ": " .. message)
    rednet.send(id, message)
end

function waitForReply(waitFor)
    while true do
        local _, reply = rednet.receive(5)
        if reply and string.find(reply, waitFor) then
            print("✔ " .. reply)
            break
        end
    end
end

function stop()
    print("Stopping farm")
end

function toggleDrills()
    if drill_state then
        send(nodeDrills, kw_drills_backward)
        waitForReplay(kw_drills_fb_backward)
    else 
        send(nodeDrills, kw_drills_frontward)
        waitForReply(kw_drills_fb_frontward)
    end
    drill_state = not drill_state
end

for i=1,10 do
    toggleDrills()
    sleep(3)
end
